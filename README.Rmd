---
title: "README.md"
author: "Davis Clark"
date: "Saturday, April 25, 2015"
output: html_document
---

##Introduction

run_analysis.R transforms the Human Activity Recognition (HAR) dataset into a tidy data text file - 'summary.txt' - that meets the principles of tidy data, as defined by Hadley Wickham, in *Tidy Data* (Wickham 4): 

        1. Each variable forms a column
        2. Each observation forms a row
        3. Each type of observational unit forms a table
At a high level, run_analysis.R performs the following:
        
        1. Merges the HAR training and test subsets, creating a unified HAR dataset
        2. Extracts only the measurements on the mean and standard deviation for each measurement 
        3. Substitutes descriptive activity names for the ambiguous HAR activity ID numbers
        4. Appropriately labels the data set with descriptive variable names
        5. Generates a second, independent tidy dataset, with the average of each variable, 
           for each activity and each subject

## Repository contents  

This repository includes the following files:

- **'README.md'**: details the inner workings of run_analysis.R 

- **'CodeBook.md'**: lists the features included in the tidy dataset and defines the information that each variable measures

- **'run_analysis.R'**: a script that transforms the HAR dataset into a tidy data text file that meets the principles of tidy data as defined by Hadley Wickham

- **'summary.txt'**: a tidy data text file that meets the principles of tidy data; the following R code can be used to read and view the tidy dataset via RStudio:

```
summary <- read.table('summary.txt', header=TRUE)
View(summary)
```
  
## run_analysis script design

```{r config, echo=FALSE, message=FALSE}
library(reshape2)
library(dplyr)
```

The Human Activity Recognition dataset is composed of 10,299 observations and 561 attributes in total; run_analysis distills this set into a dataframe of 11,880 observations and 1 attribute, excluding our 3 factor columns.

The data are derived from a subset of the HAR dataset and summarized by calculating the mean of each measurement observed for each activity per subject. The following will present the script's working process: 

```{r, cache=TRUE}
subjectTrain <- read.table("UCI HAR Dataset/train/subject_train.txt")
subjectTest <- read.table("UCI HAR Dataset/test/subject_test.txt")
activityTrain <- read.table("UCI HAR Dataset/train/y_train.txt")
activityTest <- read.table("UCI HAR Dataset/test/y_test.txt")
featuresTrain <- read.table("UCI HAR Dataset/train/X_train.txt")
featuresTest <- read.table("UCI HAR Dataset/test/X_test.txt")
activityLabels <- read.table("UCI HAR Dataset/activity_labels.txt")
featureLabels <- read.table("UCI HAR Dataset/features.txt")
```

First, the HAR training and test subsets are rejoined through a series of `rbind()` commands, yielding a complete HAR dataframe: 

```{r joining test & train}
subjects <- rbind(subjectTest, subjectTrain)
activities <- rbind(activityTest, activityTrain)
features <- rbind(featuresTest, featuresTrain)     
data <- data.frame(subjects, activities, features)
```

We substitute the activity IDs with labels that are readable:

```{r activity labels}
names(data) <- c("subject", "activity", as.character(featureLabels[, 2]))
        
i <- 1    
activityLabels$V2 <- tolower(activityLabels$V2)
activityLabels$V2 <- gsub("_", "", activityLabels$V2)
activityLabels$V2 <- gsub("stairs", "", activityLabels$V2)    
for (a in activityLabels$V2) {
        data$activity <- gsub(i, activityLabels$V2[[i]], data$activity)
        i <- i + 1
}
```

Next, we extract the HAR mean and standard deviation signal estimates, bringing focus to our tidy data through a more limited feature set: 

```{r extracting mean & std estimates}
extract <- c(1:2, sort(c(grep("mean\\(\\)", names(data)), 
                         grep("std\\(\\)", names(data)))))
dataExtract <- data[, extract]
```

Note: we can quickly clean up our variable names before performing the final transformation:

```{r formatting column names}
names(dataExtract) <- gsub("\\)", "", gsub("\\(", "", names(dataExtract)))
names(dataExtract) <- tolower(gsub("\\-", "_", names(dataExtract)))
```

Then, we melt the HAR dataframe and cast an independent, tidy dataset, summarized by the mean of each variable per each activity per subject:

```{r casting tidy dataset}
melted <- melt(dataExtract, id.vars = c("subject", "activity"))
summary <- dcast(melted, activity + subject ~ ... , mean)
summary <- melt(summary, id.vars = c("subject", "activity"))
names(summary)[3:4] <- c("feature", "mean")
```

And our tidy data is ready:

```{r}
head(summary, 6)
tail(summary, 6)
```

*For more information about this dataset contact: davissclark@gmail.com*

Hadley Wickham (2014). "Tidy Data." Journal of Statistical 
Software, 59(10). URL http://www.jstatsoft.org/v59/i10/.